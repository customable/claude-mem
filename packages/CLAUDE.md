<claude-mem-context>
# Recent Activity

<!-- This section is auto-generated by claude-mem. Edit content outside the tags. -->

### Jan 25

| ID | Time | T | Title | Read |
|----|------|---|-------|------|
| #280 | 12:03 PM | ğŸ”„ | Refactor metrics system to use interface-based configuration | ~5842 |
| #279 | 12:02 PM | ğŸŸ  | Added centralized metrics configuration for Prometheus | ~2890 |
| #278 | 12:02 PM | ğŸŸ  | Added metrics type definitions for Issue #258 | ~1367 |
| #277 | 12:02 PM | ğŸ”µ | Exploring shared TypeScript types in claude-mem | ~1065 |
| #276 | 12:02 PM | ğŸŸ  | Added metrics configuration types export to types index | ~1215 |
| #272 | 12:01 PM | ğŸ”µ | Prometheus metrics implementation for monitoring | ~2166 |
| #270 | 12:01 PM | ğŸŸ  | Added Package Structure Documentation to CLAUDE.md | ~4272 |
| #264 | 12:01 PM | ğŸ”µ | Reviewed recent development activity log | ~2215 |
| #262 | 12:00 PM | ğŸ”µ | Environment variables and I/O handling in hooks package | ~1761 |
| #260 | 12:00 PM | ğŸ”µ | Subagent event tracking in session-service.ts | ~1205 |
| #259 | 12:00 PM | ğŸ”µ | Subagent functionality exists across multiple files | ~1029 |
| #255 | 12:00 PM | ğŸ”µ | Task system architecture for Backend-Worker system | ~2977 |
| #253 | 12:00 PM | ğŸ”µ | Worker lifecycle and process exit patterns in hooks package | ~1957 |
| #250 | 12:00 PM | ğŸ”µ | MCP Server Implementation Analysis | ~3023 |
| #248 | 12:00 PM | ğŸ”µ | Understanding the Hook Runner Architecture | ~2148 |
| #247 | 12:00 PM | ğŸ”µ | Subagent Stop Hook Handler Implementation | ~1265 |
| #246 | 12:00 PM | ğŸ”µ | Plugin entry point architecture and event mapping | ~3044 |
| #245 | 12:00 PM | ğŸ”µ | Subagent Start Hook Handler Implementation | ~1328 |
| #244 | 12:00 PM | ğŸ”µ | Post-tool-use handler processes tool usage for observation extraction | ~2609 |
| #241 | 12:00 PM | ğŸ”µ | Exploring Hooks Router Implementation | ~3455 |
| #240 | 12:00 PM | ğŸ”µ | Hook handlers registry structure discovered | ~1479 |
| #239 | 12:00 PM | ğŸ”µ | Session Start Handler Implementation Analysis | ~3290 |
| #233 | 12:00 PM | ğŸ”µ | User prompt submission handler with secret detection and urgency detection | ~2003 |
| #231 | 12:00 PM | ğŸ”µ | Hook system types and structure discovered | ~1604 |
| #220 | 11:58 AM | ğŸ”µ | Observation type configuration and utilities discovered | ~2243 |
| #218 | 11:58 AM | ğŸ”µ | Task Service Overview and Backpressure Mechanism | ~1543 |
| #217 | 11:58 AM | ğŸ”µ | Observation Entity Structure Analysis | ~1635 |
| #210 | 11:57 AM | ğŸŸ  | Added Auto-Spawn Status Indicator to WorkerStatus Component | ~5481 |
| #209 | 11:57 AM | ğŸ”µ | MemoriesView component structure and functionality | ~1593 |
| #208 | 11:57 AM | ğŸŸ  | Added auto-spawn fields to SpawnStatus interface | ~5578 |

## Key Insights

- **Metrics System Refactoring**: Major refactoring of the metrics system to use interface-based configuration, with centralized Prometheus metrics setup.
- **Subagent Architecture**: Subagent functionality is distributed across multiple files, with lifecycle tracking and event broadcasting.
- **Task System**: The task system architecture includes deduplication, backpressure mechanisms, and worker lifecycle management.
- **UI Enhancements**: Added auto-spawn status indicators and configuration fields to the WorkerStatus component.
- **Documentation**: Comprehensive package structure documentation added to CLAUDE.md, improving codebase navigation.
</claude-mem-context>

# Package Structure

## Dependency Graph

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  types   â”‚  â† Pure TypeScript interfaces, no runtime code
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  shared  â”‚  â† Runtime utilities: logger, settings, paths
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â–¼                 â–¼                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ database â”‚     â”‚  worker  â”‚     â”‚  hooks   â”‚
â”‚          â”‚     â”‚          â”‚â—„â”€â”€â”€â”€â”‚          â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ backend  â”‚     â”‚    ui    â”‚  â† Communicates via HTTP API
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Package Overview

| Package | Purpose | Key Exports |
|---------|---------|-------------|
| **types** | TypeScript definitions | Interfaces, types, enums (no runtime) |
| **shared** | Runtime utilities | `createLogger`, `loadSettings`, `PATHS` |
| **database** | Data persistence | MikroORM entities, repositories |
| **backend** | API server | Express routes, services, WebSocket |
| **hooks** | Claude integration | Hook handlers for Claude Code events |
| **worker** | AI processing | Observation extraction, summarization |
| **ui** | Web interface | React/Vite frontend |

## Guidelines

### Where to put new code?

- **New interface/type?** â†’ `types`
- **Utility function used by multiple packages?** â†’ `shared`
- **Database entity or query?** â†’ `database`
- **API endpoint?** â†’ `backend`
- **Claude hook handler?** â†’ `hooks`
- **AI task processing?** â†’ `worker`
- **UI component?** â†’ `ui`

### Import Rules

1. `types` has no internal dependencies
2. `shared` only imports from `types`
3. `database` imports from `shared` and `types`
4. `backend` can import from all except `hooks` and `ui`
5. `ui` has no internal dependencies (HTTP API only)