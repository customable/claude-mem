<claude-mem-context>
# Recent Activity

<!-- This section is auto-generated by claude-mem. Edit content outside the tags. -->

### Jan 25

| ID | Time | T | Title | Read |
|----|------|---|-------|------|
| #2372 | 6:06 PM | ğŸ”µ | Achievement unlocking logic in insights-service | ~1592 |
| #2371 | 6:06 PM | ğŸ”µ | Bug fix count tracking across packages | ~1625 |
| #2368 | 6:06 PM | ğŸ”µ | Discovered updateDailyStats method | ~1270 |
| #2366 | 6:06 PM | ğŸ”µ | Bugfix tracking logic in insights-service | ~1384 |
| #2362 | 6:05 PM | ğŸ”µ | ObservationType definition in database.ts | ~1252 |
| #2360 | 6:04 PM | ğŸ”µ | Database.ts type definitions for observations | ~1806 |
| #2357 | 6:04 PM | ğŸ”µ | InsightsSummary interface structure | ~1673 |
| #2350 | 6:03 PM | ğŸ”µ | ACHIEVEMENTS constant in insights-service | ~1067 |
| #2344 | 6:02 PM | ğŸ”µ | Backend service routes and dependencies | ~1231 |
| #2343 | 6:02 PM | ğŸ”µ | getStats method in ArchivedOutputRepository | ~1982 |
| #2336 | 6:02 PM | ğŸ”µ | ArchivedOutputs references in database | ~1175 |
| #2335 | 6:02 PM | ğŸ”µ | Backend API routes for project settings | ~1694 |
| #2328 | 6:02 PM | ğŸ”µ | DataRouter initialization and usage | ~1858 |
| #2327 | 6:02 PM | ğŸ”µ | Archived outputs depend on Endless Mode | ~1275 |
| #2326 | 6:02 PM | ğŸ”µ | SSE Writer process spawning mechanism | ~2333 |
| #2319 | 6:01 PM | ğŸ”µ | Repository pattern types and search | ~2065 |
| #2317 | 6:01 PM | ğŸ”µ | Metrics router implementation | ~1938 |
| #2316 | 6:01 PM | ğŸ”µ | ArchivedOutput entity structure | ~1781 |
| #2315 | 6:01 PM | ğŸ”µ | SSE Writer pattern in hooks package | ~1272 |
| #2313 | 6:00 PM | ğŸ”µ | Archived-output references in routes | ~1125 |
| #2288 | 5:56 PM | ğŸ”µ | OPENAI_EMBEDDING_MODEL in settings | ~1142 |
| #2280 | 5:55 PM | ğŸ”µ | Achievement system in Insights view | ~2190 |
| #2276 | 5:55 PM | ğŸ”µ | Mistral embedding provider | ~1841 |
| #2272 | 5:54 PM | ğŸ”µ | Insights achievements functionality | ~1066 |
| #2268 | 5:54 PM | ğŸ”µ | Progress and achievement files | ~1083 |
| #2257 | 5:53 PM | ğŸŸ  | Implemented OpenAI Agent | ~2970 |
| #2256 | 5:53 PM | ğŸ”µ | Worker package.json analysis | ~1619 |
| #2254 | 5:53 PM | ğŸ”µ | Mistral agent implementation | ~2149 |
| #2250 | 5:52 PM | ğŸ”µ | Worker capability resolution logic | ~1969 |
| #2249 | 5:52 PM | ğŸ”µ | Task processing in worker-service | ~2216 |

## Key Insights

- **Achievement System Bug**: The achievement progress calculation has a bug preventing partial progress tracking, requiring a fix for proper functionality.
- **SSE Writer Issue**: The SSE writer process fails due to incorrect file path handling, needing a fix for directory path resolution.
- **Missing API Endpoint**: The `GET /api/data/archived-outputs/stats` endpoint is missing and needs implementation for archived outputs statistics.
- **Embedding Models**: The project uses both OpenAI and Mistral embedding models, with configurable settings for different providers.
- **Worker Architecture**: The worker service uses a priority-based capability resolution system (CLI > env vars > settings > auto-detection) for task processing.
</claude-mem-context>

# Package Structure

## Dependency Graph

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  types   â”‚  â† Pure TypeScript interfaces, no runtime code
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  shared  â”‚  â† Runtime utilities: logger, settings, paths
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â–¼                 â–¼                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ database â”‚     â”‚  worker  â”‚     â”‚  hooks   â”‚
â”‚          â”‚     â”‚          â”‚â—„â”€â”€â”€â”€â”‚          â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ backend  â”‚     â”‚    ui    â”‚  â† Communicates via HTTP API
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Package Overview

| Package | Purpose | Key Exports |
|---------|---------|-------------|
| **types** | TypeScript definitions | Interfaces, types, enums (no runtime) |
| **shared** | Runtime utilities | `createLogger`, `loadSettings`, `PATHS` |
| **database** | Data persistence | MikroORM entities, repositories |
| **backend** | API server | Express routes, services, WebSocket |
| **hooks** | Claude integration | Hook handlers for Claude Code events |
| **worker** | AI processing | Observation extraction, summarization |
| **ui** | Web interface | React/Vite frontend |

## Guidelines

### Where to put new code?

- **New interface/type?** â†’ `types`
- **Utility function used by multiple packages?** â†’ `shared`
- **Database entity or query?** â†’ `database`
- **API endpoint?** â†’ `backend`
- **Claude hook handler?** â†’ `hooks`
- **AI task processing?** â†’ `worker`
- **UI component?** â†’ `ui`

### Import Rules

1. `types` has no internal dependencies
2. `shared` only imports from `types`
3. `database` imports from `shared` and `types`
4. `backend` can import from all except `hooks` and `ui`
5. `ui` has no internal dependencies (HTTP API only)