<claude-mem-context>
# Recent Activity

<!-- This section is auto-generated by claude-mem. Edit content outside the tags. -->

### Jan 25, 2026

| ID | Time | T | Title | Read |
|----|------|---|-------|------|
| #3449 | 8:45 PM | ğŸ”µ | API Client Structure and Types | ~1814 |
| #3440 | 8:44 PM | ğŸ”µ | SSE Event Type Definition and Usage | ~2338 |
| #3438 | 8:43 PM | ğŸ”µ | HUB_TOKEN/Settings Interface Files | ~1267 |
| #3433 | 8:43 PM | ğŸ”µ | Endless Mode & Default Settings | ~2383 |
| #3428 | 8:42 PM | ğŸŸ  | HubFederation WebSocket Exports | ~2220 |
| #3426 | 8:41 PM | ğŸŸ  | Worker-Hub Package Index | ~1400 |
| #3423 | 8:41 PM | ğŸŸ  | Worker Hub CLI Creation | ~2907 |
| #3417 | 8:39 PM | ğŸ”µ | Worker Package Config | ~1615 |
| #3415 | 8:39 PM | âš™ï¸ | Worker-Hub TypeScript Config | ~1304 |
| #3414 | 8:38 PM | ğŸŸ  | FederatedRouter Exports | ~1972 |
| #3413 | 8:38 PM | ğŸŸ  | Worker-Hub Package.json | ~1946 |
| #3407 | 8:37 PM | ğŸ”µ | WebSocket Module Exports | ~1314 |
| #3393 | 8:32 PM | ğŸ”µ | MikroORM Migration Config | ~2002 |
| #3392 | 8:32 PM | ğŸ“¦ | Worker Federation Migration | ~2377 |
| #3391 | 8:31 PM | ğŸ”µ | Worker Migration Files | ~1436 |
| #3390 | 8:31 PM | ğŸ”µ | MikroORM Migration Structure | ~1295 |
| #3385 | 8:30 PM | ğŸ”µ | Hub Registry Filtering | ~1674 |
| #3377 | 8:30 PM | ğŸ”µ | Worker Token Service Methods | ~1744 |
| #3371 | 8:28 PM | ğŸ”µ | Worker Token Validation | ~2206 |
| #3357 | 8:26 PM | ğŸŸ  | SqlEntityManager Type Export | ~1913 |
| #3356 | 8:26 PM | ğŸ”µ | EntityManager Usage | ~1309 |
| #3355 | 8:26 PM | ğŸ”µ | Database Module Import | ~1105 |
| #3354 | 8:26 PM | ğŸ”µ | No MikroORM Dependency | ~1087 |
| #3353 | 8:26 PM | ğŸ”µ | MikroORM Exports Structure | ~1419 |
| #3351 | 8:25 PM | ğŸ”µ | MikroORM Initializer | ~1943 |
| #3349 | 8:25 PM | ğŸ“ | Database Documentation | ~1396 |
| #3348 | 8:25 PM | ğŸ”µ | Database Entities | ~1574 |
| #3346 | 8:25 PM | ğŸ”µ | Shared TypeScript Types | ~1544 |
| #3344 | 8:24 PM | ğŸ”„ | Ref Type Import Separation | ~1981 |
| #3343 | 8:24 PM | ğŸ”µ | WorkerRegistration Entity | ~1647 |

## Key Insights

- **Worker Federation Implementation**: Major progress on Issue #263 with new WorkerToken, WorkerRegistration, and Hub entities, plus WebSocket exports for federated routing (FederatedRouter, HubFederation).
- **Database Architecture**: MikroORM is central to the system with 20+ entities, migrations, and a clear repository pattern. No direct MikroORM dependency in backend (likely abstracted).
- **CLI & Distributed Deployment**: New worker-hub package with CLI capabilities for standalone hubs, supporting authentication and WebSocket communication.
- **Type Safety Improvements**: Refactored type imports (e.g., `Ref`) and added SqlEntityManager exports for better service integration.
- **Next Steps**: Merge worker federation changes (Issue #263), test distributed deployment, and address multi-database support (SQLite + PostgreSQL).
</claude-mem-context>

# Package Structure

## Dependency Graph

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  types   â”‚  â† Pure TypeScript interfaces, no runtime code
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  shared  â”‚  â† Runtime utilities: logger, settings, paths
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â–¼                 â–¼                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ database â”‚     â”‚  worker  â”‚     â”‚  hooks   â”‚
â”‚          â”‚     â”‚          â”‚â—„â”€â”€â”€â”€â”‚          â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ backend  â”‚     â”‚    ui    â”‚  â† Communicates via HTTP API
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Package Overview

| Package | Purpose | Key Exports |
|---------|---------|-------------|
| **types** | TypeScript definitions | Interfaces, types, enums (no runtime) |
| **shared** | Runtime utilities | `createLogger`, `loadSettings`, `PATHS` |
| **database** | Data persistence | MikroORM entities, repositories |
| **backend** | API server | Express routes, services, WebSocket |
| **hooks** | Claude integration | Hook handlers for Claude Code events |
| **worker** | AI processing | Observation extraction, summarization |
| **ui** | Web interface | React/Vite frontend |

## Guidelines

### Where to put new code?

- **New interface/type?** â†’ `types`
- **Utility function used by multiple packages?** â†’ `shared`
- **Database entity or query?** â†’ `database`
- **API endpoint?** â†’ `backend`
- **Claude hook handler?** â†’ `hooks`
- **AI task processing?** â†’ `worker`
- **UI component?** â†’ `ui`

### Import Rules

1. `types` has no internal dependencies
2. `shared` only imports from `types`
3. `database` imports from `shared` and `types`
4. `backend` can import from all except `hooks` and `ui`
5. `ui` has no internal dependencies (HTTP API only)