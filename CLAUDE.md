# Claude-Mem Development Instructions

**WICHTIG: Alle Anweisungen in dieser Datei sind verbindlich und mÃ¼ssen strikt befolgt werden!**

## Workflow

### Commits & Push

- **Pro Issue mindestens ein Commit** (gerne auch mehr bei grÃ¶ÃŸeren Ã„nderungen)
- **Pushen nur mit Freigabe vom User**, auÃŸer der Prompt am Anfang erlaubt direktes Pushen
- Bei mehreren Issues: Pro Issue eigene Commits erstellen, dann am Ende gesammelt pushen (nach Freigabe)

### Issues umsetzen

- **Issues IMMER komplett umsetzen** - nicht in Phasen oder Teilschritten
- Erst mit dem nÃ¤chsten Issue beginnen, wenn das aktuelle vollstÃ¤ndig abgeschlossen ist
- Bei Blockern oder Unklarheiten: User fragen, nicht teilweise implementieren

### CLAUDE.md Dateien

- **Automatisch generierte CLAUDE.md-Dateien regelmÃ¤ÃŸig mit committen**
- Diese Dateien werden vom Plugin automatisch aktualisiert
- User-Content auÃŸerhalb der generierten Bereiche bleibt erhalten

## Technische Details

### Monorepo-Struktur

```
packages/
â”œâ”€â”€ backend/     # Express API Server
â”œâ”€â”€ database/    # MikroORM Entities & Repositories
â”œâ”€â”€ hooks/       # Claude Code Hook Handlers
â”œâ”€â”€ shared/      # Shared Utilities (Logger, Settings)
â”œâ”€â”€ types/       # TypeScript Interfaces
â”œâ”€â”€ ui/          # React/Vite Frontend
â””â”€â”€ worker/      # AI Task Processing
plugin/          # Claude Code Plugin
```

### Wichtige Befehle

```bash
# Development
pnpm dev              # Build plugin + sync to marketplace
pnpm build            # Build all packages
pnpm test             # Run tests
pnpm typecheck        # TypeScript check (1x ausfÃ¼hren bis "Done", bei unklarer Ausgabe Script anpassen)
pnpm sync-marketplace # Sync plugin to Claude marketplace
pnpm dev:restart      # Restart dev services

# Einzelne Packages builden
pnpm build:backend    # Backend only
pnpm build:worker     # Worker only
pnpm build:hooks      # Hooks only
pnpm build:plugin     # Plugin only

# Docker
pnpm docker:up        # Start containers
pnpm docker:down      # Stop containers
pnpm docker:logs      # View logs
```

### Issue-Tracker

- Repository: `customable/claude-mem` auf Forgejo
- Labels werden automatisch gesetzt (priority, type)
- **Kommentare und Attachments in Issues IMMER prÃ¼fen** - kÃ¶nnen wichtige Informationen enthalten
- **Blocks und Dependencies beachten** - Issues kÃ¶nnen andere blockieren oder von anderen abhÃ¤ngen

### UI-Referenzen

- Screenshots und Design-Referenzen: `~/references`

### Bei grÃ¶ÃŸeren Ã„nderungen

Nach Ã„nderungen an Backend, Worker oder Hooks:

1. **Plugin builden und syncen:**
   ```bash
   pnpm build && pnpm sync-marketplace
   ```

2. **Backend-Erreichbarkeit prÃ¼fen:**
   - Nach Neustart testen ob Backend erreichbar ist
   - Falls nicht erreichbar: Erst stoppen, dann **ohne** `-head` oder `-tail` neustarten
   - Direkt die JS-Datei ausfÃ¼hren um vollstÃ¤ndigen Log zu sehen:
     ```bash
     node packages/backend/dist/cli.js start
     ```

<claude-mem-context>
# Recent Activity

<!-- This section is auto-generated by claude-mem. Edit content outside the tags. -->

### Jan 25

| ID | Time | T | Title | Read |
|----|------|---|-------|------|
| #3576 | 9:06 PM | ğŸ”µ | Examining API response structure in hooks route | ~1117 |
| #3575 | 9:06 PM | ğŸ”µ | Exploring hooks.ts route handling for session start | ~1397 |
| #3574 | 9:05 PM | ğŸ”µ | [Compressed] Edit | ~106 |
| #3573 | 9:05 PM | ğŸ”µ | Task handling logic in post-tool-use handler | ~1556 |
| #3572 | 9:05 PM | ğŸ”µ | [Compressed] Edit | ~116 |
| #3571 | 9:05 PM | ğŸ”µ | Discovered Task Tools Set in post-tool-use.ts | ~1173 |
| #3570 | 9:05 PM | ğŸ”µ | [Compressed] Edit | ~100 |
| #3569 | 9:05 PM | ğŸ”µ | [Compressed] Edit | ~118 |
| #3568 | 9:05 PM | ğŸ”µ | [Compressed] Edit | ~124 |
| #3567 | 9:05 PM | ğŸ”µ | Discovered MemoryTier and SdkSessionRecord types | ~1335 |
| #3566 | 9:05 PM | ğŸ”µ | [Compressed] Edit | ~135 |
| #3565 | 9:05 PM | ğŸ”µ | Discovered Session Update and Query Interfaces | ~1262 |
| #3564 | 9:05 PM | ğŸ”µ | [Compressed] Edit | ~101 |
| #3563 | 9:04 PM | ğŸ”µ | [Compressed] Read | ~138 |
| #3562 | 9:04 PM | ğŸ”µ | Discovering SessionRepository usage | ~1182 |
| #3561 | 9:04 PM | ğŸ”µ | [Compressed] Edit | ~100 |
| #3560 | 9:04 PM | ğŸ”µ | Discovered Session Update and Query Interfaces | ~1207 |
| #3559 | 9:04 PM | ğŸ”µ | Discovered SdkSessionRecord interface structure | ~2071 |
| #3558 | 9:04 PM | ğŸ”µ | Discovered Session Repository Interface | ~2235 |
| #3557 | 9:03 PM | ğŸ“¦ | Add plan mode tracking to sessions table | ~1896 |
| #3556 | 9:03 PM | ğŸ”µ | Found SessionUpdate interface in repository.ts | ~1024 |
| #3555 | 9:03 PM | ğŸ”µ | [Compressed] Edit | ~115 |
| #3554 | 9:03 PM | ğŸ”µ | [Compressed] Read | ~174 |
| #3553 | 9:03 PM | ğŸ”µ | Located SessionService class definition | ~997 |
| #3552 | 9:03 PM | ğŸ”µ | [Compressed] Read | ~163 |
| #3551 | 9:03 PM | ğŸ”µ | [Compressed] Edit | ~135 |
| #3550 | 9:03 PM | ğŸ”µ | Discovered migration list usage in MikroORM | ~1423 |
| #3549 | 9:03 PM | ğŸ”µ | Session Entity Structure Analysis | ~1973 |
| #3548 | 9:03 PM | ğŸŸ  | Track PlanMode status on Session level | ~2396 |
| #3547 | 9:03 PM | ğŸ”µ | Discovered MikroORM migration files structure | ~1407 |

## Key Insights

- **Session Management Architecture**: Discovered core session management components including `SessionRepository`, `MikroOrmSessionRepository`, and `SessionService` classes, along with `SdkSessionRecord` interface and `MemoryTier` types. These form the foundation of session tracking and memory management.

- **Task Handling System**: Identified task-related tool set (`TaskCreate`, `TaskUpdate`, `TaskList`, `TaskGet`) and their processing logic in `post-tool-use.ts`, revealing how user tasks are captured and managed through API calls.

- **PlanMode Feature**: Issue #317 proposes tracking PlanMode status at session level. A migration (#3557) was created to add `is_in_plan_mode`, `plan_mode_entered_at`, and `plan_mode_count` columns to the sessions table.

- **Database Migration Pattern**: The project uses explicit `migrationsList` in MikroORM configuration rather than glob patterns, requiring manual addition of new migrations to avoid .d.ts file issues.

- **API Structure**: Examined hooks route handling in `hooks.ts`, particularly the session start endpoint which accepts both `sessionId` and legacy `contentSessionId` parameters, with specific validation requirements.
</claude-mem-context>
